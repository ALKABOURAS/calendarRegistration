<form id="send-message-form" class="message-form" action="/messages/send" method="post">
    <input type="hidden" name="sender_id" value="{{user.id}}">
    <div class="form-group">
        <label for="receiver_username">Receiver:</label>
        <input type="text" id="receiver_username" name="receiver_username" required>
    </div>
    <div class="form-group">
        <label for="content">Message:</label>
        <textarea id="content" name="content" required></textarea>
    </div>
    <button type="submit" class="submit-btn">Send</button>
</form>

<div id="messages-container">
{{#each messages}}
    <div class="message {{#if this.unread}}unread{{/if}}">
        <p>From: {{this.sender_id}}</p>
        <p>{{this.message}}</p>
        <form action="/messages/read/{{this.id}}" method="post">
            <button type="submit">Mark as Read</button>
        </form>
        <form action="/messages/unread/{{this.id}}" method="post">
            <button type="submit">Mark as Unread</button>
        </form>
        <form action="/messages/delete/{{this.id}}" method="post">
            <button type="submit">Delete</button>
        </form>
    </div>
{{/each}}
</div>

<script>
    document.getElementById('send-message-form').addEventListener('submit', function(event) {
        event.preventDefault();

        var sender_id = document.querySelector('input[name="sender_id"]').value;
        var receiver_username = document.querySelector('input[name="receiver_username"]').value;
        var content = document.querySelector('textarea[name="content"]').value;

        fetch('/messages/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ sender_id, receiver_username, content }),
        })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        alert(data.success);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
    });
</script>